function cov_23wnonlslp(){var path="C:\\Users\\wei long\\Documents\\devoppart2\\BookTrack_DevOps_Project\\utils\\add-transaction-util.js";var hash="1ef4eefd41696a0cbd66d7244070cc5085589843";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\wei long\\Documents\\devoppart2\\BookTrack_DevOps_Project\\utils\\add-transaction-util.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:41}},"1":{start:{line:2,column:26},end:{line:2,column:68}},"2":{start:{line:5,column:63},end:{line:5,column:71}},"3":{start:{line:7,column:4},end:{line:49,column:5}},"4":{start:{line:9,column:21},end:{line:9,column:49}},"5":{start:{line:10,column:8},end:{line:12,column:9}},"6":{start:{line:11,column:12},end:{line:11,column:70}},"7":{start:{line:15,column:8},end:{line:17,column:9}},"8":{start:{line:16,column:12},end:{line:16,column:80}},"9":{start:{line:20,column:30},end:{line:20,column:50}},"10":{start:{line:21,column:30},end:{line:21,column:50}},"11":{start:{line:23,column:8},end:{line:25,column:9}},"12":{start:{line:24,column:12},end:{line:24,column:103}},"13":{start:{line:28,column:34},end:{line:31,column:10}},"14":{start:{line:33,column:8},end:{line:35,column:9}},"15":{start:{line:34,column:12},end:{line:34,column:100}},"16":{start:{line:38,column:31},end:{line:43,column:10}},"17":{start:{line:45,column:8},end:{line:45,column:36}},"18":{start:{line:46,column:8},end:{line:46,column:65}},"19":{start:{line:48,column:8},end:{line:48,column:86}},"20":{start:{line:52,column:0},end:{line:52,column:36}}},fnMap:{"0":{name:"addTransaction",decl:{start:{line:4,column:15},end:{line:4,column:29}},loc:{start:{line:4,column:40},end:{line:50,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:10,column:8},end:{line:12,column:9}},type:"if",locations:[{start:{line:10,column:8},end:{line:12,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:10},"1":{loc:{start:{line:15,column:8},end:{line:17,column:9}},type:"if",locations:[{start:{line:15,column:8},end:{line:17,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:15},"2":{loc:{start:{line:23,column:8},end:{line:25,column:9}},type:"if",locations:[{start:{line:23,column:8},end:{line:25,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:23},"3":{loc:{start:{line:23,column:12},end:{line:23,column:76}},type:"binary-expr",locations:[{start:{line:23,column:12},end:{line:23,column:42}},{start:{line:23,column:46},end:{line:23,column:76}}],line:23},"4":{loc:{start:{line:33,column:8},end:{line:35,column:9}},type:"if",locations:[{start:{line:33,column:8},end:{line:35,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"1ef4eefd41696a0cbd66d7244070cc5085589843"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_23wnonlslp=function(){return actualCoverage;};}return actualCoverage;}cov_23wnonlslp();const Book=(cov_23wnonlslp().s[0]++,require('../models/book.js'));const BorrowTransaction=(cov_23wnonlslp().s[1]++,require('../models/borrow-transaction.js'));async function addTransaction(req,res){cov_23wnonlslp().f[0]++;const{book_id,borrower_name,borrowDate,returnDate}=(cov_23wnonlslp().s[2]++,req.body);cov_23wnonlslp().s[3]++;try{// Validate book ID
const book=(cov_23wnonlslp().s[4]++,await Book.findById(book_id));cov_23wnonlslp().s[5]++;if(!book){cov_23wnonlslp().b[0][0]++;cov_23wnonlslp().s[6]++;return res.status(400).json({error:"Invalid book ID"});}else{cov_23wnonlslp().b[0][1]++;}// Validate borrower name
cov_23wnonlslp().s[7]++;if(!borrower_name){cov_23wnonlslp().b[1][0]++;cov_23wnonlslp().s[8]++;return res.status(400).json({error:"Borrower name is required"});}else{cov_23wnonlslp().b[1][1]++;}// Validate dates
const borrowDateObj=(cov_23wnonlslp().s[9]++,new Date(borrowDate));const returnDateObj=(cov_23wnonlslp().s[10]++,new Date(returnDate));cov_23wnonlslp().s[11]++;if((cov_23wnonlslp().b[3][0]++,isNaN(borrowDateObj.getTime()))||(cov_23wnonlslp().b[3][1]++,isNaN(returnDateObj.getTime()))){cov_23wnonlslp().b[2][0]++;cov_23wnonlslp().s[12]++;return res.status(400).json({error:"Invalid date format for borrowDate or returnDate"});}else{cov_23wnonlslp().b[2][1]++;}// Check if the book is currently borrowed (e.g., an active transaction exists)
const activeTransaction=(cov_23wnonlslp().s[13]++,await BorrowTransaction.findOne({book_id:book._id,returnDate:{$gte:new Date()}// Book is considered "borrowed" if returnDate is in the future
}));cov_23wnonlslp().s[14]++;if(activeTransaction){cov_23wnonlslp().b[4][0]++;cov_23wnonlslp().s[15]++;return res.status(400).json({error:"This book is already borrowed by another user"});}else{cov_23wnonlslp().b[4][1]++;}// Create new transaction if the book is available
const newTransaction=(cov_23wnonlslp().s[16]++,new BorrowTransaction({book_id:book._id,borrower:{name:borrower_name},borrowDate:borrowDateObj,returnDate:returnDateObj}));cov_23wnonlslp().s[17]++;await newTransaction.save();cov_23wnonlslp().s[18]++;res.json({message:"Transaction added successfully!"});}catch(error){cov_23wnonlslp().s[19]++;res.status(500).json({error:"Error saving transaction: "+error.message});}}cov_23wnonlslp().s[20]++;module.exports={addTransaction};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjN3bm9ubHNscCIsImFjdHVhbENvdmVyYWdlIiwiQm9vayIsInMiLCJyZXF1aXJlIiwiQm9ycm93VHJhbnNhY3Rpb24iLCJhZGRUcmFuc2FjdGlvbiIsInJlcSIsInJlcyIsImYiLCJib29rX2lkIiwiYm9ycm93ZXJfbmFtZSIsImJvcnJvd0RhdGUiLCJyZXR1cm5EYXRlIiwiYm9keSIsImJvb2siLCJmaW5kQnlJZCIsImIiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJib3Jyb3dEYXRlT2JqIiwiRGF0ZSIsInJldHVybkRhdGVPYmoiLCJpc05hTiIsImdldFRpbWUiLCJhY3RpdmVUcmFuc2FjdGlvbiIsImZpbmRPbmUiLCJfaWQiLCIkZ3RlIiwibmV3VHJhbnNhY3Rpb24iLCJib3Jyb3dlciIsIm5hbWUiLCJzYXZlIiwibWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhZGQtdHJhbnNhY3Rpb24tdXRpbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBCb29rID0gcmVxdWlyZSgnLi4vbW9kZWxzL2Jvb2suanMnKTtcclxuY29uc3QgQm9ycm93VHJhbnNhY3Rpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvYm9ycm93LXRyYW5zYWN0aW9uLmpzJyk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBhZGRUcmFuc2FjdGlvbihyZXEsIHJlcykge1xyXG4gICAgY29uc3QgeyBib29rX2lkLCBib3Jyb3dlcl9uYW1lLCBib3Jyb3dEYXRlLCByZXR1cm5EYXRlIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFZhbGlkYXRlIGJvb2sgSURcclxuICAgICAgICBjb25zdCBib29rID0gYXdhaXQgQm9vay5maW5kQnlJZChib29rX2lkKTtcclxuICAgICAgICBpZiAoIWJvb2spIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBib29rIElEXCIgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWYWxpZGF0ZSBib3Jyb3dlciBuYW1lXHJcbiAgICAgICAgaWYgKCFib3Jyb3dlcl9uYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIkJvcnJvd2VyIG5hbWUgaXMgcmVxdWlyZWRcIiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFZhbGlkYXRlIGRhdGVzXHJcbiAgICAgICAgY29uc3QgYm9ycm93RGF0ZU9iaiA9IG5ldyBEYXRlKGJvcnJvd0RhdGUpO1xyXG4gICAgICAgIGNvbnN0IHJldHVybkRhdGVPYmogPSBuZXcgRGF0ZShyZXR1cm5EYXRlKTtcclxuXHJcbiAgICAgICAgaWYgKGlzTmFOKGJvcnJvd0RhdGVPYmouZ2V0VGltZSgpKSB8fCBpc05hTihyZXR1cm5EYXRlT2JqLmdldFRpbWUoKSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCBkYXRlIGZvcm1hdCBmb3IgYm9ycm93RGF0ZSBvciByZXR1cm5EYXRlXCIgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgYm9vayBpcyBjdXJyZW50bHkgYm9ycm93ZWQgKGUuZy4sIGFuIGFjdGl2ZSB0cmFuc2FjdGlvbiBleGlzdHMpXHJcbiAgICAgICAgY29uc3QgYWN0aXZlVHJhbnNhY3Rpb24gPSBhd2FpdCBCb3Jyb3dUcmFuc2FjdGlvbi5maW5kT25lKHtcclxuICAgICAgICAgICAgYm9va19pZDogYm9vay5faWQsXHJcbiAgICAgICAgICAgIHJldHVybkRhdGU6IHsgJGd0ZTogbmV3IERhdGUoKSB9IC8vIEJvb2sgaXMgY29uc2lkZXJlZCBcImJvcnJvd2VkXCIgaWYgcmV0dXJuRGF0ZSBpcyBpbiB0aGUgZnV0dXJlXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChhY3RpdmVUcmFuc2FjdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJUaGlzIGJvb2sgaXMgYWxyZWFkeSBib3Jyb3dlZCBieSBhbm90aGVyIHVzZXJcIiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgdHJhbnNhY3Rpb24gaWYgdGhlIGJvb2sgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgY29uc3QgbmV3VHJhbnNhY3Rpb24gPSBuZXcgQm9ycm93VHJhbnNhY3Rpb24oe1xyXG4gICAgICAgICAgICBib29rX2lkOiBib29rLl9pZCxcclxuICAgICAgICAgICAgYm9ycm93ZXI6IHsgbmFtZTogYm9ycm93ZXJfbmFtZSB9LFxyXG4gICAgICAgICAgICBib3Jyb3dEYXRlOiBib3Jyb3dEYXRlT2JqLFxyXG4gICAgICAgICAgICByZXR1cm5EYXRlOiByZXR1cm5EYXRlT2JqLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBhd2FpdCBuZXdUcmFuc2FjdGlvbi5zYXZlKCk7XHJcbiAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiBcIlRyYW5zYWN0aW9uIGFkZGVkIHN1Y2Nlc3NmdWxseSFcIiB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogXCJFcnJvciBzYXZpbmcgdHJhbnNhY3Rpb246IFwiICsgZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IGFkZFRyYW5zYWN0aW9uIH07XHJcbiJdLCJtYXBwaW5ncyI6IjhzR0FlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWixLQUFNLENBQUFFLElBQUksRUFBQUYsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxFQUN6QyxLQUFNLENBQUFDLGlC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