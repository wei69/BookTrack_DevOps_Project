function cov_2bteol5poc(){var path="C:\\Users\\wei long\\Documents\\devoppart2\\BookTrack_DevOps_Project\\utils\\add-book-util.js";var hash="bf8f4ea7bf2171717d7cfccbd44458dee6628298";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\wei long\\Documents\\devoppart2\\BookTrack_DevOps_Project\\utils\\add-book-util.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:41}},"1":{start:{line:6,column:4},end:{line:50,column:5}},"2":{start:{line:8,column:64},end:{line:8,column:72}},"3":{start:{line:11,column:28},end:{line:11,column:62}},"4":{start:{line:14,column:31},end:{line:14,column:59}},"5":{start:{line:15,column:33},end:{line:15,column:92}},"6":{start:{line:15,column:60},end:{line:15,column:91}},"7":{start:{line:18,column:37},end:{line:18,column:63}},"8":{start:{line:19,column:8},end:{line:21,column:9}},"9":{start:{line:20,column:12},end:{line:20,column:67}},"10":{start:{line:24,column:29},end:{line:24,column:57}},"11":{start:{line:25,column:8},end:{line:27,column:9}},"12":{start:{line:26,column:12},end:{line:26,column:66}},"13":{start:{line:30,column:8},end:{line:32,column:9}},"14":{start:{line:31,column:12},end:{line:31,column:67}},"15":{start:{line:35,column:24},end:{line:42,column:10}},"16":{start:{line:45,column:8},end:{line:45,column:29}},"17":{start:{line:46,column:8},end:{line:46,column:70}},"18":{start:{line:48,column:8},end:{line:48,column:51}},"19":{start:{line:49,column:8},end:{line:49,column:84}},"20":{start:{line:54,column:0},end:{line:54,column:29}}},fnMap:{"0":{name:"addBook",decl:{start:{line:5,column:15},end:{line:5,column:22}},loc:{start:{line:5,column:33},end:{line:51,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:52},end:{line:15,column:53}},loc:{start:{line:15,column:60},end:{line:15,column:91}},line:15}},branchMap:{"0":{loc:{start:{line:19,column:8},end:{line:21,column:9}},type:"if",locations:[{start:{line:19,column:8},end:{line:21,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:19},"1":{loc:{start:{line:25,column:8},end:{line:27,column:9}},type:"if",locations:[{start:{line:25,column:8},end:{line:27,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:25},"2":{loc:{start:{line:30,column:8},end:{line:32,column:9}},type:"if",locations:[{start:{line:30,column:8},end:{line:32,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bf8f4ea7bf2171717d7cfccbd44458dee6628298"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2bteol5poc=function(){return actualCoverage;};}return actualCoverage;}cov_2bteol5poc();// Import the Book model to interact with the database
const Book=(cov_2bteol5poc().s[0]++,require('../models/book.js'));// Define an asynchronous function to handle adding a new book
async function addBook(req,res){cov_2bteol5poc().f[0]++;cov_2bteol5poc().s[1]++;try{// Destructure the required book details from the request body
const{title,author,isbn,genre,availableCopies}=(cov_2bteol5poc().s[2]++,req.body);// Convert the uploaded file buffer to a Base64 encoded string for the image
const imageBase64=(cov_2bteol5poc().s[3]++,req.file.buffer.toString('base64'));// Fetch all existing titles, normalize them, and store in an array
const existingTitles=(cov_2bteol5poc().s[4]++,await Book.find({},'title'));const normalizedTitles=(cov_2bteol5poc().s[5]++,existingTitles.map(book=>{cov_2bteol5poc().f[1]++;cov_2bteol5poc().s[6]++;return book.title.toLowerCase().trim();}));// Check if the normalized input title exists in the array of normalized titles
const normalizedInputTitle=(cov_2bteol5poc().s[7]++,title.toLowerCase().trim());cov_2bteol5poc().s[8]++;if(normalizedTitles.includes(normalizedInputTitle)){cov_2bteol5poc().b[0][0]++;cov_2bteol5poc().s[9]++;return res.status(400).json({error:'title_exists'});}else{cov_2bteol5poc().b[0][1]++;}// Check for existing ISBN to prevent duplicate entries
const existingISBN=(cov_2bteol5poc().s[10]++,await Book.findOne({isbn}));cov_2bteol5poc().s[11]++;if(existingISBN){cov_2bteol5poc().b[1][0]++;cov_2bteol5poc().s[12]++;return res.status(400).json({error:'isbn_exists'});}else{cov_2bteol5poc().b[1][1]++;}// Ensure ISBN is numeric and has exactly 13 digits
cov_2bteol5poc().s[13]++;if(!/^\d{13}$/.test(isbn)){cov_2bteol5poc().b[2][0]++;cov_2bteol5poc().s[14]++;return res.status(400).json({error:'isbn_invalid'});}else{cov_2bteol5poc().b[2][1]++;}// Create a new instance of the Book model with the provided data
const newBook=(cov_2bteol5poc().s[15]++,new Book({title,author,isbn,genre,availableCopies,image:imageBase64// Store image as Base64 encoded string
}));// Save the new book instance to the database
cov_2bteol5poc().s[16]++;await newBook.save();cov_2bteol5poc().s[17]++;res.status(201).json({message:'Book added successfully!'});// Send success response
}catch(error){cov_2bteol5poc().s[18]++;console.error('Error adding book:',error);// Log any errors encountered
cov_2bteol5poc().s[19]++;res.status(500).json({error:'An error occurred while adding the book.'});// Send error response
}}// Export the addBook function to make it available in other parts of the application
cov_2bteol5poc().s[20]++;module.exports={addBook};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMmJ0ZW9sNXBvYyIsImFjdHVhbENvdmVyYWdlIiwiQm9vayIsInMiLCJyZXF1aXJlIiwiYWRkQm9vayIsInJlcSIsInJlcyIsImYiLCJ0aXRsZSIsImF1dGhvciIsImlzYm4iLCJnZW5yZSIsImF2YWlsYWJsZUNvcGllcyIsImJvZHkiLCJpbWFnZUJhc2U2NCIsImZpbGUiLCJidWZmZXIiLCJ0b1N0cmluZyIsImV4aXN0aW5nVGl0bGVzIiwiZmluZCIsIm5vcm1hbGl6ZWRUaXRsZXMiLCJtYXAiLCJib29rIiwidG9Mb3dlckNhc2UiLCJ0cmltIiwibm9ybWFsaXplZElucHV0VGl0bGUiLCJpbmNsdWRlcyIsImIiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJleGlzdGluZ0lTQk4iLCJmaW5kT25lIiwidGVzdCIsIm5ld0Jvb2siLCJpbWFnZSIsInNhdmUiLCJtZXNzYWdlIiwiY29uc29sZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhZGQtYm9vay11dGlsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEltcG9ydCB0aGUgQm9vayBtb2RlbCB0byBpbnRlcmFjdCB3aXRoIHRoZSBkYXRhYmFzZVxyXG5jb25zdCBCb29rID0gcmVxdWlyZSgnLi4vbW9kZWxzL2Jvb2suanMnKTtcclxuXHJcbi8vIERlZmluZSBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24gdG8gaGFuZGxlIGFkZGluZyBhIG5ldyBib29rXHJcbmFzeW5jIGZ1bmN0aW9uIGFkZEJvb2socmVxLCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gRGVzdHJ1Y3R1cmUgdGhlIHJlcXVpcmVkIGJvb2sgZGV0YWlscyBmcm9tIHRoZSByZXF1ZXN0IGJvZHlcclxuICAgICAgICBjb25zdCB7IHRpdGxlLCBhdXRob3IsIGlzYm4sIGdlbnJlLCBhdmFpbGFibGVDb3BpZXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDb252ZXJ0IHRoZSB1cGxvYWRlZCBmaWxlIGJ1ZmZlciB0byBhIEJhc2U2NCBlbmNvZGVkIHN0cmluZyBmb3IgdGhlIGltYWdlXHJcbiAgICAgICAgY29uc3QgaW1hZ2VCYXNlNjQgPSByZXEuZmlsZS5idWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG5cclxuICAgICAgICAvLyBGZXRjaCBhbGwgZXhpc3RpbmcgdGl0bGVzLCBub3JtYWxpemUgdGhlbSwgYW5kIHN0b3JlIGluIGFuIGFycmF5XHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUaXRsZXMgPSBhd2FpdCBCb29rLmZpbmQoe30sICd0aXRsZScpO1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRUaXRsZXMgPSBleGlzdGluZ1RpdGxlcy5tYXAoYm9vayA9PiBib29rLnRpdGxlLnRvTG93ZXJDYXNlKCkudHJpbSgpKTtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG5vcm1hbGl6ZWQgaW5wdXQgdGl0bGUgZXhpc3RzIGluIHRoZSBhcnJheSBvZiBub3JtYWxpemVkIHRpdGxlc1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJbnB1dFRpdGxlID0gdGl0bGUudG9Mb3dlckNhc2UoKS50cmltKCk7XHJcbiAgICAgICAgaWYgKG5vcm1hbGl6ZWRUaXRsZXMuaW5jbHVkZXMobm9ybWFsaXplZElucHV0VGl0bGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAndGl0bGVfZXhpc3RzJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBJU0JOIHRvIHByZXZlbnQgZHVwbGljYXRlIGVudHJpZXNcclxuICAgICAgICBjb25zdCBleGlzdGluZ0lTQk4gPSBhd2FpdCBCb29rLmZpbmRPbmUoeyBpc2JuIH0pO1xyXG4gICAgICAgIGlmIChleGlzdGluZ0lTQk4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdpc2JuX2V4aXN0cycgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBFbnN1cmUgSVNCTiBpcyBudW1lcmljIGFuZCBoYXMgZXhhY3RseSAxMyBkaWdpdHNcclxuICAgICAgICBpZiAoIS9eXFxkezEzfSQvLnRlc3QoaXNibikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdpc2JuX2ludmFsaWQnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBCb29rIG1vZGVsIHdpdGggdGhlIHByb3ZpZGVkIGRhdGFcclxuICAgICAgICBjb25zdCBuZXdCb29rID0gbmV3IEJvb2soe1xyXG4gICAgICAgICAgICB0aXRsZSxcclxuICAgICAgICAgICAgYXV0aG9yLFxyXG4gICAgICAgICAgICBpc2JuLFxyXG4gICAgICAgICAgICBnZW5yZSxcclxuICAgICAgICAgICAgYXZhaWxhYmxlQ29waWVzLFxyXG4gICAgICAgICAgICBpbWFnZTogaW1hZ2VCYXNlNjQsIC8vIFN0b3JlIGltYWdlIGFzIEJhc2U2NCBlbmNvZGVkIHN0cmluZ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBTYXZlIHRoZSBuZXcgYm9vayBpbnN0YW5jZSB0byB0aGUgZGF0YWJhc2VcclxuICAgICAgICBhd2FpdCBuZXdCb29rLnNhdmUoKTtcclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IG1lc3NhZ2U6ICdCb29rIGFkZGVkIHN1Y2Nlc3NmdWxseSEnIH0pOyAvLyBTZW5kIHN1Y2Nlc3MgcmVzcG9uc2VcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWRkaW5nIGJvb2s6JywgZXJyb3IpOyAvLyBMb2cgYW55IGVycm9ycyBlbmNvdW50ZXJlZFxyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBhZGRpbmcgdGhlIGJvb2suJyB9KTsgLy8gU2VuZCBlcnJvciByZXNwb25zZVxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgdGhlIGFkZEJvb2sgZnVuY3Rpb24gdG8gbWFrZSBpdCBhdmFpbGFibGUgaW4gb3RoZXIgcGFydHMgb2YgdGhlIGFwcGxpY2F0aW9uXHJcbm1vZHVsZS5leHBvcnRzID0geyBhZGRCb29rIH07XHJcbiJdLCJtYXBwaW5ncyI6Ink1RkFlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWjtBQUNBLEtBQU0sQ0FBQUUsSUFBSSxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBRXpDO0FBQ0EsY0FBZSxDQUFBQyxPQUFPQSxDQUFDQyxHQUFHLENBQUVDLEdBQUcsQ0FBRSxDQUFBUCxjQUFBLEdBQUFRLENBQUEsTUFBQVIsY0FBQSxHQUFBRyxDQUFBLE1BQzdCLEdBQUksQ0FDQTtBQUNBLEtBQU0sQ0FBRU0sS0FBSyxDQUFFQyxNQUFNLENBQUVDLElBQUksQ0FBRUMsS0FBSyxDQUFFQyxlQUFnQixDQUFDLEVBQUFiLGNBQUEsR0FBQUcsQ0FBQSxNQUFHRyxHQUFHLENBQUNRLElBQUksRUFFaEU7QUFDQSxLQUFNLENBQUFDLFdBQVcsRUFBQWYsY0FBQSxHQUFBRyxDQUFBLE1BQUdHLEdBQUcsQ0FBQ1UsSUFBSSxDQUFDQyxNQUFNLENBQUNDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFFdEQ7QUFDQSxLQUFNLENBQUFDLGNBQWMsRUFBQW5CLGNBQUEsR0FBQUcsQ0FBQSxNQUFHLEtBQU0sQ0FBQUQsSUFBSSxDQUFDa0IsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFFLE9BQU8sQ0FBQyxFQUNuRCxLQUFNLENBQUFDLGdCQUFnQixFQUFBckIsY0FBQSxHQUFBRyxDQUFBLE1BQUdnQixjQUFjLENBQUNHLEdBQUcsQ0FBQ0MsSUFBSSxFQUFJLENBQUF2Qixj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